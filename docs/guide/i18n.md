# å›½é™…åŒ–

æœ¬ç« èŠ‚å°†ç³»ç»ŸåŒ–åœ°ã€Œæ‹†è§£ã€uni-app é¡¹ç›®ä¸­çš„å›½é™…åŒ–å®ç°æµç¨‹ï¼Œä»ç¯å¢ƒæ­å»ºåˆ°å®æˆ˜åº”ç”¨ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ ä½¿ç”¨ [vue-i18n](https://vue-i18n.intlify.dev/) ç»“åˆvscodeæ’ä»¶ [i18n-ally](https://github.com/lokalise/i18n-ally) ä¸ [WotUI](https://github.com/Moonofweisheng/wot-design-uni) æ„å»ºçµæ´»é«˜æ•ˆçš„å¤šè¯­è¨€æ”¯æŒç³»ç»Ÿï¼ŒåŒ…å«äº†å„ç±»å¹³å°ï¼ˆH5ã€å°ç¨‹åºã€Appï¼‰çš„é€‚é…è¦ç‚¹ä¸ä¼˜åŒ–ç­–ç•¥ã€‚å‡†å¤‡å¥½äº†å—ï¼ŸLet's go! ä¸å¯¹ï¼Œåº”è¯¥æ˜¯ã€Œå‡ºå‘å§ã€...å“¦ç­‰ç­‰ï¼Œè¿™ä¸å°±æ˜¯å›½é™…åŒ–çš„æ„ä¹‰æ‰€åœ¨å—ï¼ŸğŸ˜‰

> æ³¨æ„ï¼šæœ¬é¡¹ç›®æ˜¯åŸºäº `Vue3` å’Œ `WotUI` çš„ uni-app cli æ¡†æ¶å¼€å‘çš„ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Vue2ï¼Œè¯·å‚è€ƒ uni-app [æ–‡æ¡£](https://uniapp.dcloud.net.cn/tutorial/i18n.html#vue%E7%95%8C%E9%9D%A2%E5%92%8Cjs%E5%86%85%E5%AE%B9%E7%9A%84%E5%9B%BD%E9%99%85%E5%8C%96) è¿›è¡Œç›¸åº”è°ƒæ•´ã€‚

## 1. å®‰è£…å’Œé…ç½®vue-i18n

### 1.1 å®‰è£…ä¾èµ–

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…vue-i18nï¼š

```bash
# ä½¿ç”¨npm
npm install vue-i18n@9.1.9

# æˆ–è€…ä½¿ç”¨yarn
yarn add vue-i18n@9.1.9

# æˆ–è€…ä½¿ç”¨pnpm
pnpm add vue-i18n@9.1.9
```

> æ³¨æ„ï¼šæ ¹æ®[uni-appå®˜æ–¹æ–‡æ¡£](https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Ftutorial%2Fi18n.html%23vue%25E7%2595%258C%25E9%259D%25A2%25E5%2592%258Cjs%25E5%2586%2585%25E5%25AE%25B9%25E7%259A%2584%25E5%259B%25BD%25E9%2599%2585%25E5%258C%2596 "https://uniapp.dcloud.net.cn/tutorial/i18n.html#vue%E7%95%8C%E9%9D%A2%E5%92%8Cjs%E5%86%85%E5%AE%B9%E7%9A%84%E5%9B%BD%E9%99%85%E5%8C%96")å»ºè®®ï¼ŒVue3é¡¹ç›®éœ€è¦å®‰è£…vue-i18nçš„å›ºå®šç‰ˆæœ¬9.1.9ï¼Œå’Œuni-appå†…éƒ¨ä½¿ç”¨çš„vue-i18nä¿æŒä¸€è‡´ã€‚

### 1.2 åˆ›å»ºi18nå®ä¾‹

åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ç›®å½•æ¥å­˜æ”¾å›½é™…åŒ–ç›¸å…³çš„æ–‡ä»¶ï¼Œä¾‹å¦‚`src/locale`ï¼š

```typescript
// src/locale/index.ts
import { createI18n } from 'vue-i18n'
import zhCN from './zh-CN.json'
import enUS from './en-US.json'
import Locale from 'wot-design-uni/locale'
import WotEnUS from 'wot-design-uni/locale/lang/en-US'

Locale.add({ 'en-US': WotEnUS })

const messages = {
  'zh-CN': {
    ...zhCN
  },
  'en-US': {
    ...enUS
  }
}

// åˆ›å»ºi18nå®ä¾‹
const i18n = createI18n({
  locale: uni.getStorageSync('currentLang') || 'zh-CN', // é»˜è®¤è¯­è¨€
  fallbackLocale: 'zh-CN',   // å›é€€è¯­è¨€
  messages,                  // è¯­è¨€åŒ…
  legacy: false              // å¯ç”¨Composition APIæ¨¡å¼
})

// åŒæ­¥ç»„ä»¶åº“è¯­è¨€
Locale.use(i18n.global.locale.value)
uni.setLocale(i18n.global.locale.value)

export default i18n
```

### 1.3 åœ¨main.tsä¸­æ³¨å†Œi18n

```typescript
// src/main.ts
import { createApp } from 'vue'
import App from './App.vue'
import i18n from './locale'

const app = createApp(App)
app.use(i18n)
app.mount('#app')
```

## 2\. è¯­è¨€æ–‡ä»¶çš„ç»„ç»‡ç»“æ„

### 2.1 åŸºæœ¬ç»“æ„

è¯­è¨€æ–‡ä»¶é€šå¸¸ä»¥JSONæ ¼å¼å­˜å‚¨ï¼Œæ¯ç§è¯­è¨€ä¸€ä¸ªæ–‡ä»¶ï¼š

```bash
src/locale/
  â”œâ”€â”€ index.ts          # i18né…ç½®å’Œå®ä¾‹
  â”œâ”€â”€ zh-CN.json        # ä¸­æ–‡è¯­è¨€åŒ…
  â””â”€â”€ en-US.json        # è‹±æ–‡è¯­è¨€åŒ…
```

### 2.2 è¯­è¨€æ–‡ä»¶å†…å®¹

è¯­è¨€æ–‡ä»¶æ˜¯é”®å€¼å¯¹çš„é›†åˆï¼Œé”®æ˜¯å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå€¼æ˜¯å¯¹åº”è¯­è¨€çš„æ–‡æœ¬ï¼š

```json
// zh-CN.json
{
  "hello": "ä½ å¥½",
  "welcome": "æ¬¢è¿ä½¿ç”¨",
  "button": "æŒ‰é’®"
}

// en-US.json
{
  "hello": "Hello",
  "welcome": "Welcome to use",
  "button": "Button"
}
```

### 2.3 åµŒå¥—ç»“æ„

å¯¹äºå¤æ‚åº”ç”¨ï¼Œå¯ä»¥ä½¿ç”¨åµŒå¥—ç»“æ„ç»„ç»‡è¯­è¨€æ–‡ä»¶ï¼š

```json
// zh-CN.json
{
  "common": {
    "confirm": "ç¡®è®¤",
    "cancel": "å–æ¶ˆ"
  },
  "home": {
    "title": "é¦–é¡µ",
    "welcome": "æ¬¢è¿å›æ¥"
  }
}
```

## 3\. ä½¿ç”¨useI18nSyncé’©å­å®ç°å¤šè¯­è¨€åˆ‡æ¢

åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ª`useI18nSync`é’©å­æ¥åŒæ­¥åº”ç”¨å’Œç»„ä»¶åº“çš„è¯­è¨€è®¾ç½®ï¼š

```typescript
// src/hooks/useI18nSync.ts
import { computed, onBeforeMount } from 'vue'
import { Locale } from 'wot-design-uni/locale'
import i18n from '../locale'

const SUPPORTED_LOCALES = [
  'zh-CN',
  'en-US',
]

function setLocale(locale: string, syncComponentLib: boolean = true) {
  if (!SUPPORTED_LOCALES.includes(locale)) {
    console.warn(`ä¸æ”¯æŒçš„è¯­è¨€: ${locale}ï¼Œå°†ä½¿ç”¨é»˜è®¤è¯­è¨€ zh-CN`)
    locale = 'zh-CN'
  }
  uni.setLocale(locale)
  i18n.global.locale.value = locale
  uni.setStorageSync('currentLang', locale)
  if (syncComponentLib) {
    Locale.use(locale)
  }
  return locale
}

function initLocale(defaultLocale: string, syncComponentLib: boolean) {
  const storedLocale = uni.getStorageSync('currentLang') || defaultLocale
  setLocale(storedLocale, syncComponentLib)
}

interface I18nSyncOptions {
  /** æ˜¯å¦åŒæ­¥ç»„ä»¶åº“è¯­è¨€è®¾ç½® */
  syncComponentLib?: boolean
  /** é»˜è®¤è¯­è¨€ */
  defaultLocale?: string
}

/**
 * å›½é™…åŒ–åŒæ­¥hook
 * @param options é…ç½®é€‰é¡¹
 * @returns å›½é™…åŒ–ç›¸å…³æ–¹æ³•å’ŒçŠ¶æ€
 */
export function useI18nSync(options?: I18nSyncOptions) {
  const { syncComponentLib = true, defaultLocale = 'zh-CN' } = options || {}
  const currentLang = computed(() => i18n.global.locale.value)
  onBeforeMount(() => {
    initLocale(defaultLocale, syncComponentLib)
  })

  return {
    currentLang,
    setLocale: (locale: string) => setLocale(locale, syncComponentLib),
    supportedLocales: SUPPORTED_LOCALES
  }
}
```

### 3.1 åœ¨App.vueä¸­åˆå§‹åŒ–è¯­è¨€

```vue
<script setup lang="ts">
import { useI18nSync } from './hooks/useI18nSync'

// åˆå§‹åŒ–å›½é™…åŒ–è®¾ç½®
const { currentLang, setLocale } = useI18nSync()
</script>
```

### 3.2 å®ç°è¯­è¨€åˆ‡æ¢åŠŸèƒ½

```vue
<template>
  <view class="language-switcher">
    <view class="current-lang">{{ $t('dangQianYuYan') }}: {{ currentLang }}</view>
    <wd-button @click="switchLanguage('zh-CN')">ä¸­æ–‡</wd-button>
    <wd-button @click="switchLanguage('en-US')">English</wd-button>
  </view>
</template>

<script setup lang="ts">
import { useI18nSync } from '../hooks/useI18nSync'

const { currentLang, setLocale } = useI18nSync()

function switchLanguage(locale: string) {
  setLocale(locale)
}
</script>
```

## 4\. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨å›½é™…åŒ–æ–‡æœ¬

### 4.1 ä½¿ç”¨Composition API

åœ¨Vue3çš„Composition APIä¸­ä½¿ç”¨i18nï¼š

```vue
<template>
  <view class="page">
    <view class="title">{{ t('hello') }}</view>
    <view class="content">{{ t('welcome') }}</view>
    <wd-button>{{ t('button') }}</wd-button>
  </view>
</template>

<script setup lang="ts">
import { useI18n } from 'vue-i18n'

const { t } = useI18n()
</script>
```

### 4.2 ä½¿ç”¨æ¨¡æ¿è¯­æ³•

ç›´æ¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨$tå‡½æ•°ï¼š

```vue
<template>
  <view class="page">
    <view class="title">{{ $t('hello') }}</view>
    <view class="content">{{ $t('welcome') }}</view>
    <wd-button>{{ $t('button') }}</wd-button>
  </view>
</template>
```

### 4.3 åŠ¨æ€è®¡ç®—å±æ€§

ä½¿ç”¨computedä½¿å†…å®¹å“åº”è¯­è¨€å˜åŒ–ï¼š

```vue
<script setup lang="ts">
import { computed } from 'vue'
import { useI18n } from 'vue-i18n'

const { t } = useI18n()

// ä½¿ç”¨computedä½¿listå“åº”è¯­è¨€å˜åŒ–
const list = computed(() => [
  {
    id: 'widget',
    name: t('ji-chu'),
    pages: [
      {
        id: 'button',
        name: t('button-an-niu')
      },
      // å…¶ä»–é¡¹...
    ]
  }
])
</script>
```

## 5\. å¤„ç†åŠ¨æ€å†…å®¹çš„å›½é™…åŒ–

### 5.1 å¹³å°é™åˆ¶ä¸è§£å†³æ–¹æ¡ˆ

æ ¹æ®uni-appå®˜æ–¹æ–‡æ¡£ï¼Œç”±äºè¿è¡Œå¹³å°é™åˆ¶ï¼Œ**ç›®å‰åœ¨å°ç¨‹åºå’ŒAppç«¯ä¸æ”¯æŒæ’å€¼æ–¹å¼å®šä¹‰å›½é™…åŒ–**ã€‚è¿™æ„å‘³ç€ä»¥ä¸‹æ–¹å¼åœ¨å°ç¨‹åºå’ŒAppç«¯æ— æ³•æ­£å¸¸å·¥ä½œï¼š

```typescript
// è¿™ç§æ–¹å¼åœ¨å°ç¨‹åºå’ŒAppç«¯ä¸æ”¯æŒ
t('hello', { name: 'å°æ˜' }) // ä½¿ç”¨å‘½åå‚æ•°
t('hello', ['å°æ˜']) // ä½¿ç”¨æ•°ç»„å‚æ•°
```

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰çš„æ’å€¼æ–¹æ³•æ¥å¤„ç†å¸¦å‚æ•°çš„ç¿»è¯‘ã€‚

### 5.2 å¸¦å‚æ•°çš„ç¿»è¯‘

åœ¨å°ç¨‹åºå’ŒAppç«¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„å ä½ç¬¦æ ¼å¼å’Œè‡ªå®šä¹‰æ’å€¼æ–¹æ³•æ¥å¤„ç†åŒ…å«å˜é‡çš„æ–‡æœ¬ï¼š

```typescript
// åœ¨è¯­è¨€æ–‡ä»¶ä¸­å®šä¹‰å¸¦å ä½ç¬¦çš„æ–‡æœ¬
// zh-CN.json
{
  "greeting": "ä½ å¥½ï¼Œ{0}ï¼",
  "welcome": "æ¬¢è¿{0}æ¥åˆ°{1}"
}

// ä½¿ç”¨æ—¶ä¼ å…¥å‚æ•°
t('greeting', ['å°æ˜'])
// è¾“å‡ºï¼šä½ å¥½ï¼Œå°æ˜ï¼

t('welcome', ['å°æ˜', 'wot-design-uni'])
// è¾“å‡ºï¼šæ¬¢è¿å°æ˜æ¥åˆ°wot-design-uni
```

> æ³¨æ„ï¼šæˆ‘ä»¬ä½¿ç”¨`{0}`, `{1}`è¿™æ ·çš„æ•°å­—ç´¢å¼•å ä½ç¬¦ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å‘½åå‚æ•°å¦‚`{name}`ã€‚è¿™æ˜¯å› ä¸ºå°ç¨‹åºå’ŒAppç«¯ä¸æ”¯æŒå‘½åå‚æ•°çš„æ’å€¼æ–¹å¼ã€‚

### 5.3 å®ç°æ’å€¼å·¥å…·å‡½æ•°

```typescript
// src/locale/utils.ts
/**
 * æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„å ä½ç¬¦
 * @param template æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œå¦‚ "Hello {0}, welcome to {1}"
 * @param values è¦æ›¿æ¢çš„å€¼æ•°ç»„
 * @returns æ›¿æ¢åçš„å­—ç¬¦ä¸²
 */
export function interpolateTemplate(template: string, values: any[]): string {
  return template.replace(/{(\d+)}/g, (_, index) => values[index] ?? '')
}
```

### 5.4 æ‰©å±•tå‡½æ•°æ”¯æŒæ•°ç»„å‚æ•°

ç”±äºå°ç¨‹åºå’ŒAppç«¯çš„é™åˆ¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰©å±•vue-i18nçš„tå‡½æ•°ï¼Œä½¿å…¶èƒ½å¤Ÿå¤„ç†æ•°ç»„å‚æ•°å¹¶åº”ç”¨æˆ‘ä»¬çš„æ’å€¼æ–¹æ³•ï¼š

```typescript
// src/locale/index.ts
import { createI18n } from 'vue-i18n'
import zhCN from './zh-CN.json'
import enUS from './en-US.json'
import { interpolateTemplate } from './utils'

// åˆ›å»ºi18nå®ä¾‹
const i18n = createI18n({
  locale: 'zh-CN',
  fallbackLocale: 'zh-CN',
  messages: {
    'zh-CN': zhCN,
    'en-US': enUS
  },
  legacy: false
})

// æ‰©å±•tå‡½æ•°ï¼Œæ”¯æŒæ•°ç»„å‚æ•°æ’å€¼
// è¿™æ˜¯è§£å†³å°ç¨‹åºå’ŒAppç«¯ä¸æ”¯æŒæ’å€¼æ–¹å¼çš„å…³é”®æ­¥éª¤
const originalT = i18n.global.t
i18n.global.t = ((key: string | number, param1?: any, param2?: any) => {
  const result = originalT(key, param1, param2)
  // æ£€æµ‹æ˜¯å¦ä¼ å…¥äº†æ•°ç»„å‚æ•°ï¼Œå¦‚æœæ˜¯åˆ™ä½¿ç”¨æˆ‘ä»¬çš„æ’å€¼æ–¹æ³•å¤„ç†
  if (Array.isArray(param1)) {
    return interpolateTemplate(result, param1)
  }
  return result
}) as typeof i18n.global.t

export default i18n
```

è¿™ç§æ‰©å±•æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ï¼š

1.  ä¿æŒäº†ä¸vue-i18nåŸæœ‰APIçš„å…¼å®¹æ€§
2.  åœ¨å°ç¨‹åºå’ŒAppç«¯ä¹Ÿèƒ½ä½¿ç”¨ç±»ä¼¼çš„å‚æ•°ä¼ é€’æ–¹å¼
3.  ç»Ÿä¸€äº†ä¸åŒå¹³å°çš„å›½é™…åŒ–ä½¿ç”¨ä½“éªŒ

> éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬ä»…å®ç°äº†æ•°ç»„å‚æ•°çš„æ’å€¼ï¼Œå¦‚æœéœ€è¦æ”¯æŒæ›´å¤šå‚æ•°ç±»å‹ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ‰©å±•ã€‚

### 5.5 ä½¿ç”¨ç¤ºä¾‹

```vue
<template>
  <!-- åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ -->
  <view>{{ $t('greeting', [username]) }}</view>
  <view>{{ $t('welcome', [username, 'wot-design-uni']) }}</view>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { useI18n } from 'vue-i18n'

const { t } = useI18n()
const username = ref('å°æ˜')

// åœ¨JS/TSä»£ç ä¸­ä½¿ç”¨
const message = t('greeting', [username.value])
</script>
```

> æ³¨æ„ï¼šè¿™ç§æ–¹æ³•åœ¨H5ã€Appå’Œå°ç¨‹åºç­‰æ‰€æœ‰å¹³å°ä¸Šéƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†è‡ªå®šä¹‰çš„æ’å€¼æ–¹æ³•æ¥å¤„ç†å‚æ•°ï¼Œç»•è¿‡äº†å°ç¨‹åºå’ŒAppç«¯çš„é™åˆ¶ã€‚

## 6\. ç»„ä»¶åº“çš„å›½é™…åŒ–

WotUIç»„ä»¶åº“æœ¬èº«æ”¯æŒå›½é™…åŒ–ï¼Œæˆ‘ä»¬åªéœ€è¦å‚è€ƒ[å›½é™…åŒ–](https://link.juejin.cn?target=https%3A%2F%2Fwot-design-uni.cn%2Fguide%2Flocale.html "https://wot-design-uni.cn/guide/locale.html")æ–‡æ¡£è¿›è¡Œé…ç½®å³å¯ã€‚

### 6.1 åŒæ­¥åº”ç”¨å’Œç»„ä»¶åº“çš„è¯­è¨€

ä½¿ç”¨`useI18nSync`é’©å­å¯ä»¥åŒæ­¥åº”ç”¨å’Œç»„ä»¶åº“çš„è¯­è¨€è®¾ç½®ï¼š

```typescript
// åŒæ­¥ç»„ä»¶åº“è¯­è¨€è®¾ç½®
if (syncComponentLib) {
  Locale.use(locale)
}
```

## 7\. pages.jsonçš„å›½é™…åŒ–

> æ³¨æ„ï¼šå»ºè®®ä»”ç»†é˜…è¯»uni-app[å›½é™…åŒ–æ–‡æ¡£](https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Ftutorial%2Fi18n.html%23vue%25E7%2595%258C%25E9%259D%25A2%25E5%2592%258Cjs%25E5%2586%2585%25E5%25AE%25B9%25E7%259A%2584%25E5%259B%25BD%25E9%2599%2585%25E5%258C%2596 "https://uniapp.dcloud.net.cn/tutorial/i18n.html#vue%E7%95%8C%E9%9D%A2%E5%92%8Cjs%E5%86%85%E5%AE%B9%E7%9A%84%E5%9B%BD%E9%99%85%E5%8C%96")ã€‚

### 7.1 é¡µé¢æ ‡é¢˜å›½é™…åŒ–

åœ¨uni-appä¸­ï¼Œpages.jsonä¸­çš„é¡µé¢æ ‡é¢˜å¯ä»¥é€šè¿‡å ä½ç¬¦å®ç°å›½é™…åŒ–ï¼š

```json
// pages.json
{
  "pages": [
    {
      "path": "pages/index/index",
      "style": {
        "navigationBarTitleText": "%index-title%"
      }
    }
  ]
}
```

### 7.2 è¯­è¨€æ–‡ä»¶é…ç½®

åœ¨è¯­è¨€æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„ç¿»è¯‘ï¼š

```json
// zh-CN.json
{
  "index-title": "é¦–é¡µ"
}

// en-US.json
{
  "index-title": "Home"
}
```

### 7.3 å¹³å°å·®å¼‚å¤„ç†

-   **H5å¹³å°**ï¼šç›´æ¥æ”¯æŒå ä½ç¬¦æ–¹å¼
-   **å…¶ä»–å¹³å°**ï¼šå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰Tabbarå’ŒNavbarå®ç°

> æ³¨æ„ï¼šå°ç¨‹åºä¸‹ä¸æ”¯æŒè¿™ç§å›½é™…åŒ–æ–¹æ¡ˆï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è®¾ç½®tabbarå’Œnavigationbarçš„APIæ¥è®¾ç½®æ–‡å­—ã€‚æˆ–è€…åºŸå¼ƒåŸç”Ÿtabbarå’Œnavigationbarï¼Œä½¿ç”¨è‡ªå®šä¹‰æ–¹å¼ï¼Œè¯¦æƒ…å‚è€ƒ[uni-appå®˜æ–¹æ–‡æ¡£](https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Ftutorial%2Fi18n.html%23pages "https://uniapp.dcloud.net.cn/tutorial/i18n.html#pages")

## 8\. i18n-allyæ’ä»¶

### 8.1 æ’ä»¶æ¦‚è¿°

i18n-allyæ˜¯VSCodeçš„ä¸€æ¬¾å›½é™…åŒ–æ’ä»¶ï¼Œæä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

-   è‡ªåŠ¨æ£€æµ‹é¡¹ç›®ä¸­çš„ç¡¬ç¼–ç æ–‡æœ¬
-   ä¸€é”®æå–å¾…ç¿»è¯‘å†…å®¹
-   å¤šè¯­è¨€æ–‡ä»¶ç®¡ç†
-   ç¿»è¯‘è¾…åŠ©å·¥å…·é›†æˆ

### 8.2 å®‰è£…ä¸é…ç½®

1.  **å®‰è£…æ’ä»¶**ï¼š
    
    -   åœ¨VSCodeæ‰©å±•å¸‚åœºæœç´¢å¹¶å®‰è£…`i18n-ally`
    -   å®‰è£…å®Œæˆåé‡å¯VSCode
2.  **åŸºæœ¬é…ç½®**ï¼š
    
    -   åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º`.vscode/settings.json`æ–‡ä»¶
    -   æ·»åŠ ä»¥ä¸‹åŸºç¡€é…ç½®ï¼š

```json
// .vscode/settings.json
{
  "i18n-ally.sourceLanguage": "zh-CN", // é¡¹ç›®çš„â€‹â€‹åŸå§‹è¯­è¨€ï¼ˆåŸºå‡†è¯­è¨€ï¼‰â€‹â€‹ï¼Œé€šå¸¸æ˜¯å¼€å‘æ—¶ä½¿ç”¨çš„é»˜è®¤è¯­è¨€ï¼ˆå¦‚ en æˆ– zh-CNï¼‰ã€‚
  "i18n-ally.displayLanguage": "zh-CN", // æ’ä»¶â€‹â€‹ç•Œé¢ä¸­æ˜¾ç¤ºçš„è¯­è¨€â€‹â€‹ï¼ˆå¦‚æ‚¬æµ®æç¤ºã€ä¾§è¾¹æ é¢„è§ˆç­‰ï¼‰ï¼Œæ–¹ä¾¿å¼€å‘è€…æŸ¥çœ‹ç¿»è¯‘ç»“æœã€‚
  "i18n-ally.localesPaths": ["src/locale"],
  "i18n-ally.keystyle": "flat",
  "i18n-ally.sortKeys": true
}
```

![i18n-ally è®¾ç½®ç¤ºä¾‹](https://blog.wot-ui.cn/images/image_1_c3b9d87b.png)

### 8.3 æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

#### 8.3.1 è‡ªåŠ¨æ£€æµ‹

-   æ‰«æèŒƒå›´ï¼šHTMLæ ‡ç­¾å†…å®¹ã€Vueæ¨¡æ¿ã€JS/TSä»£ç 
-   æ”¯æŒé…ç½®æ£€æµ‹è§„åˆ™ï¼š

```json
"i18n-ally.extract.parsers.html": {
  "attributes": ["text", "title", "alt", "placeholder", "label", "aria-label"],
  "ignoredTags": ["script", "style"],
  "vBind": true,
  "inlineText": true
}
```

![i18n-ally æ£€æµ‹è§„åˆ™ç¤ºä¾‹](https://blog.wot-ui.cn/images/image_2_0c8f8aa3.png)

#### 8.3.2 ä¸€é”®æå–

-   è‡ªåŠ¨ç”Ÿæˆç¿»è¯‘é”®
-   ä¿æŒè¯­è¨€æ–‡ä»¶ç»“æ„ä¸€è‡´
-   æ”¯æŒæ‰¹é‡å¤„ç†

![i18n-ally ä¸€é”®æå–ç¤ºä¾‹](https://blog.wot-ui.cn/images/image_3_00d5556e.png)

> æ³¨æ„ï¼šæå–çš„ç¿»è¯‘é”®ä¼šè‡ªåŠ¨æ·»åŠ åˆ°è¯­è¨€æ–‡ä»¶ä¸­ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ ï¼Œä½†æ˜¯æ‰¹é‡æå–çš„ç¿»è¯‘é”®å€¼ä¼šä¸¢å¤±æ’å€¼å‚æ•°ï¼Œä¾‹å¦‚ï¼š`å“ˆå“ˆå“ˆ${232}`åº”å½“ç”Ÿæˆä¸º`t('hahaha', [232])`,ä½†å®é™…ä¸Šç”Ÿæˆçš„æ˜¯`t('ha-ha-ha-232-0')`ï¼Œå¯ä»¥é€‰æ‹©æ‰‹åŠ¨æ·»åŠ æ’å€¼å‚æ•°ï¼Œæˆ–è€…ç»“åˆ[8.4.1 é‡æ„æ¨¡æ¿](#841-é‡æ„æ¨¡æ¿)è¿›è¡Œä¼˜åŒ–ã€‚

#### 8.3.3 ç¿»è¯‘è¾…åŠ©

i18n-allyå†…ç½®ç¿»è¯‘APIæ”¯æŒï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç™¾åº¦ç¿»è¯‘APIä½œä¸ºç¤ºä¾‹ï¼š

1.  **æ³¨å†Œè´¦å·**ï¼šè®¿é—®[ç™¾åº¦ç¿»è¯‘å¼€æ”¾å¹³å°](https://link.juejin.cn?target=https%3A%2F%2Ffanyi-api.baidu.com%2F "https://fanyi-api.baidu.com/")æ³¨å†Œè´¦å·
2.  **åˆ›å»ºåº”ç”¨**ï¼šè·å–APP IDå’Œå¯†é’¥
3.  **é…ç½®æ’ä»¶**ï¼š

```json
"i18n-ally.translate.engines": ["baidu"],
"i18n-ally.translate.baidu.appid": "YOUR_APP_ID",
"i18n-ally.translate.baidu.key": "YOUR_SECRET_KEY"
```

![i18n-ally ç¿»è¯‘é…ç½®ç¤ºä¾‹](https://blog.wot-ui.cn/images/image_4_b160ce47.png)

### 8.4 é«˜çº§é…ç½®

#### 8.4.1 é‡æ„æ¨¡æ¿

```json
"i18n-ally.refactor.templates": [
  {
    "source": "html-inline",
    "template": "{{ $t('{key}'{args}) }}"
  },
  {
    "source": "html-attribute",
    "template": "$t('{key}'{args})"
  }
]
```

é‡æ„æ¨¡æ¿åï¼Œæå–çš„ç¿»è¯‘é”®ä¼šè‡ªåŠ¨æ·»åŠ æ’å€¼å‚æ•°ï¼Œä¾‹å¦‚ï¼š`å“ˆå“ˆå“ˆ${232}${111}`ä¼šç”Ÿæˆä¸ºæºå¸¦æ’å€¼å‚æ•°çš„æ ¼å¼`t('hahaha', 232, 111)`ï¼Œä¸è¿‡`vue-i18n`çš„`t`æ–¹æ³•ä¸æ”¯æŒè¿™ç§æ ¼å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†å±•tå‡½æ•°ï¼Œæ”¯æŒå¯å˜å‚æ•°ï¼Œå¹¶å°†å…¶ä½œä¸ºæ•°ç»„å‚æ•°æ’å€¼ã€‚

```typescript
// src/locale/index.ts
import { createI18n } from 'vue-i18n'
import zhCN from './zh-CN.json'
import enUS from './en-US.json'
import Locale from 'wot-design-uni/locale'
import WotEnUS from 'wot-design-uni/locale/lang/en-US'

Locale.add({ 'en-US': WotEnUS })

const messages = {
  'zh-CN': {
    ...zhCN
  },
  'en-US': {
    ...enUS
  }
}

// åˆ›å»ºi18nå®ä¾‹
const i18n = createI18n({
  locale: uni.getStorageSync('currentLang') || 'zh-CN',
  fallbackLocale: 'zh-CN',
  messages,
  legacy: false
})

Locale.use(i18n.global.locale.value)

uni.setLocale(i18n.global.locale.value)

const originalT = i18n.global.t
i18n.global.t = ((key: string | number, ...args: any[]) => {
  /**
   * æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„å ä½ç¬¦
   * @param template æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œå¦‚ "Hello {0}, welcome to {1}"
   * @param values è¦æ›¿æ¢çš„å€¼æ•°ç»„
   * @returns æ›¿æ¢åçš„å­—ç¬¦ä¸²
   */
  function interpolateTemplate(template: string, values: any[]): string {
    return template.replace(/{(\d+)}/g, (_, index) => values[index] ?? '')
  }

  // å¤„ç†å¯¹è±¡å‚æ•°åœºæ™¯: t(key, {key1: value1, key2: value2})
  if (args.length === 1 && typeof args[0] === 'object' && !Array.isArray(args[0])) {
    const result = originalT(key, ...args)
    return result
  }

  // å¤„ç†æ•°ç»„å‚æ•°åœºæ™¯: t(key, [arg1, arg2])
  if (args.length === 1 && Array.isArray(args[0])) {
    const result = originalT(key, args[0])
    return interpolateTemplate(result, args[0])
  }

  // å¤„ç†å¯å˜å‚æ•°åœºæ™¯: t(key, arg1, arg2, ...)
  if (args.length > 1 && args.every((arg) => typeof arg !== 'object')) {
    return interpolateTemplate(originalT(key, args), args)
  }

  // å¤„ç†é»˜è®¤åœºæ™¯: t(key) æˆ– t(key, defaultMessage) æˆ– t(key, plural) ç­‰
  const result = originalT(key, ...args)

  return result
}) as typeof i18n.global.t

export default i18n
```

#### 8.4.2 å¿½ç•¥è§„åˆ™

```json
"i18n-ally.extract.ignored": [
  "ç‰¹å®šæ–‡æœ¬",
  "æ­£åˆ™è¡¨è¾¾å¼",
]
```

## æ€»ç»“

è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†å›½é™…åŒ–é…ç½®ï¼Œå¹¶ä½¿ç”¨ `i18n-ally` æ’ä»¶å®ç°äº†å¯¹ Vue ç»„ä»¶çš„è‡ªåŠ¨æå–å’Œç¿»è¯‘ã€‚ä½ å¯ä»¥æŒ‰ç…§æœ¬ç« èŠ‚åœ¨ wot-starter ä¸­é›†æˆå¹¶å®ç°å›½é™…åŒ–åŠŸèƒ½ã€‚


## å‚è€ƒèµ„æ–™
-   [Vue i18nå®˜æ–¹æ–‡æ¡£](https://vue-i18n.intlify.dev/)
-   [uni-appå®˜æ–¹æ–‡æ¡£](https://uniapp.dcloud.net.cn/tutorial/i18n.html#vue%E7%95%8C%E9%9D%A2%E5%92%8Cjs%E5%86%85%E5%AE%B9%E7%9A%84%E5%9B%BD%E9%99%85%E5%8C%96)
-   [wot-uiå®˜æ–¹æ–‡æ¡£](https://wot-ui.cn/)
-   [i18n-allyå®˜æ–¹æ–‡æ¡£](https://github.com/lokalise/i18n-ally)
